.BeforeScriptTest: &preTest
  - mkdir ~/.ssh/
  - echo ${SSH_KEY} | base64 -d > ~/.ssh/id_rsa
  - chmod 0400 ~/.ssh/id_rsa
  - eval `ssh-agent -s` && ssh-add ~/.ssh/id_rsa
  - npm set unsafe-perm true

.ciTest:
  image: ${NODE_IMAGE}
  stage: test
  before_script: *preTest
  script:
    - npm install
    - npm run test
  allow_failure: true
  # Also specify
  # only:
  #   variables:
  #     - $CI_PIPELINE_SOURCE == "push"
  #  refs: ["development", "stage", "master"]
  #
  # or
  # only: ["merge_requests"]

.ciLint:
  image: ${NODE_IMAGE}
  stage: test
  before_script: *preTest
  script:
    - npm install
    - npm run lint
  allow_failure: true
  # Also specify
  # only:
  #   variables:
  #     - $CI_PIPELINE_SOURCE == "push"
  #  refs: ["development", "stage", "master"]
  #
  # or
  # only: ["merge_requests"]
